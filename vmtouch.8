.\" Automatically generated by Pod::Man 2.22 (Pod::Simple 3.07)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "VMTOUCH 8"
.TH VMTOUCH 8 "2012-06-22" "perl v5.10.1" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
vmtouch \- the Virtual Memory Toucher
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 1
\&    vmtouch [OPTIONS] ... FILES OR DIRECTORIES ...
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
Portable file system cache diagnostics and control.
.PP
vmtouch opens every file provided on the command line and maps it into virtual memory with \f(CWmmap(2)\fR. The mappings are opened read-only. It recursively crawls any directories and does the same to all files it finds within them.
.PP
With no options, vmtouch will not read from (touch) any memory pages.  It will only use \f(CWmincore(2)\fR to determine how many pages of each file are actually resident in memory. Before exiting, it will print a summary of the total pages encountered and how many were resident.
.IP "\-t" 4
.IX Item "-t"
Touch virtual memory pages. Reads a byte from each page of the file. If the page is not resident in memory, a page fault will be generated and the page will be read from disk into the file system's memory cache.
.Sp
Note: Although each page is guaranteed to have been brought into memory, the page might be evicted from memory by the time the vmtouch command completes.
.IP "\-e" 4
.IX Item "-e"
Evict the mapped pages from the file system cache. They will need to be read in from disk the next time they are accessed. This is the inverse of \f(CW\*(C`\-t\*(C'\fR.
.Sp
Note: Even if the eviction is successful, pages may be paged back into memory by the time the vmtouch command completes.
.Sp
Note: This option is not portable to all systems. See \s-1PORTABILITY\s0 below.
.IP "\-l" 4
.IX Item "-l"
Lock pages into physical memory. This option works the same as \f(CW\*(C`\-t\*(C'\fR except it calls \f(CWmlock(2)\fR on all the memory mappings and doesn't close the descriptors when finished. At the end of the crawl, if successful, vmtouch will block indefinitely. The files will be locked in physical memory until the vmtouch process is killed.
.Sp
Note: While the vmtouch process is holding memory locks, any processes that access the locked pages will not cause non-resident page faults or address-translation faults although they may still cause \s-1TLB\s0 misses.
.Sp
Note: Because vmtouch holds file descriptors open it may reach the \f(CW\*(C`RLIMIT_NOFILE\*(C'\fR process file descriptor limit. In this case it will try to increase the descriptor limit which will only work if the process is run with root privileges. Similarly, root privileges are required to exceed the \f(CW\*(C`RLIMIT_MEMLOCK\*(C'\fR limit. Even with root privileges, \f(CW\*(C`\-l\*(C'\fR is limited by both the system file descriptor limit and the system limit on \*(L"wired memory\*(R".
.IP "\-L" 4
.IX Item "-L"
This option is the same as \f(CW\*(C`\-l\*(C'\fR except that it uses \f(CWmlockall(2)\fR at the end of the crawl rather than individually \f(CWmlock(2)\fRing each file. Because of this, other unrelated pages belonging to the vmtouch process will also be locked in memory.
.IP "\-d" 4
.IX Item "-d"
Daemon mode. After performing the crawl, disassociate from the terminal and run in the background as a daemon. This option can only be used with the \f(CW\*(C`\-l\*(C'\fR or \f(CW\*(C`\-L\*(C'\fR locking modes.
.IP "\-m <max file size>" 4
.IX Item "-m <max file size>"
Maximum file size to map into virtual memory. Files that are larger than this will be skipped. Examples: 4096, 4k, 100M, 1.5G. The default is 500M.
.IP "\-f" 4
.IX Item "-f"
Follow symbolic links. With this option, vmtouch will descend into symbolic links that point to directories and will touch regular files pointed to by symbolic links. Symbolic link loops are detected and issue warnings.
.IP "\-v" 4
.IX Item "-v"
Verbose mode. While crawling, print out every file being processed along with its total number of pages and the number of its pages that are currently resident in memory to standard output.
.IP "\-q" 4
.IX Item "-q"
Quiet mode. Suppress the end of crawl summary and all warnings that are normally printed to standard error. On success print nothing. Fatal errors print a single error message line to standard error.
.SH "PORTABILITY"
.IX Header "PORTABILITY"
The page residency summaries depend on \f(CWmincore(2)\fR which first appeared in 4.4BSD but is not present on all unix systems.
.PP
The \f(CW\*(C`\-l\*(C'\fR and \f(CW\*(C`\-L\*(C'\fR locking options depends on \f(CWmlock(2)\fR or \f(CWmlockall(2)\fR, both of which are specified by \s-1POSIX\s0.1b\-1993, Real-Time Extensions.
.PP
The \f(CW\*(C`\-e\*(C'\fR page eviction option is the least portable. On Linux it uses \f(CWposix_fadvise(2)\fR with \f(CW\*(C`POSIX_FADV_DONTNEED\*(C'\fR advice to inform the kernel that the file should be evicted from the file system cache. \f(CWposix_fadvise(2)\fR is specified by \s-1POSIX\s0.1\-2003 \s-1TC1\s0. On FreeBSD, the pages are invalidated with \f(CWmsync(2)\fR's \f(CW\*(C`MS_INVALIDATE\*(C'\fR flag. \f(CWmsync(2)\fR is specified by \s-1POSIX\s0.1b\-1993, Real-Time Extensions, although this call is not required to remove pages from the file system cache. Some systems like OpenBSD 4.3 don't have \f(CWposix_fadvise(2)\fR, don't evict the pages on an \f(CWmsync(2)\fR/\f(CW\*(C`MS_INVALIDATE\*(C'\fR, and don't evict the pages with \f(CWmadvise(2)\fR/\f(CW\*(C`MADV_DONTNEED\*(C'\fR so \f(CW\*(C`\-e\*(C'\fR isn't supported on those systems yet. Using \f(CW\*(C`\-e\*(C'\fR on systems that don't yet support it is a fatal error.
.SH "SUPPORTED SYSTEMS"
.IX Header "SUPPORTED SYSTEMS"
All vmtouch features have been confirmed to work on the following systems:
.IP "Linux 2.6+" 4
.IX Item "Linux 2.6+"
.PD 0
.IP "FreeBSD 4.X" 4
.IX Item "FreeBSD 4.X"
.IP "FreeBSD 7.X" 4
.IX Item "FreeBSD 7.X"
.IP "Solaris 10" 4
.IX Item "Solaris 10"
.IP "\s-1OS\s0 X 10.x" 4
.IX Item "OS X 10.x"
.IP "HP-UX 11.31+patches (see below)" 4
.IX Item "HP-UX 11.31+patches (see below)"
.PD
.PP
Systems that support everything except eviction:
.IP "OpenBSD 4.3" 4
.IX Item "OpenBSD 4.3"
.PP
We would like to support as many systems as possible so please send us any success reports, failure reports or patches. Thanks!
.SH "SYSTEM NOTES"
.IX Header "SYSTEM NOTES"
Shane Seymour did the HP-UX port and says that either 32\-bit or 64\-bit binaries can be compiled (just use \f(CW\*(C`+DD64\*(C'\fR for 64\-bit). However, \f(CWmincore(2)\fR was added to HP-UX 11.31 via patches and at least the following patches need to be installed: \s-1PHKL_38651\s0, \s-1PHKL_38708\s0, \s-1PHKL_38686\s0, \s-1PHKL_38688\s0, and \s-1PHCO_38658\s0 (or patches that supersede those ones).
.SH "SEE ALSO"
.IX Header "SEE ALSO"
Not all the following manual pages may exist in every unix dialect to which vmtouch has been ported.
.PP
\&\fIvmstat\fR\|(8), \fItouch\fR\|(1), \fImmap\fR\|(2), \fImincore\fR\|(2), \fImlock\fR\|(2), \fImlockall\fR\|(2), \fImsync\fR\|(2), \fImadvise\fR\|(2), \fIposix_fadvise\fR\|(2)
.SH "AUTHOR"
.IX Header "AUTHOR"
Written by Doug Hoyte <doug@hcsw.org>
